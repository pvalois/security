#!/usr/bin/env python3

import sys
import time
import re
from pymetasploit3.msfrpc import MsfRpcClient
from pymetasploit3.msfconsole import MsfRpcConsole

global_positive_out = list()
global_console_status = False
targets = list()

def read_console(console_data):
  global global_console_status
  global targets

  global_console_status = console_data['busy']

  if ('[+]' in console_data['data']):
    sigdata = console_data['data'].rstrip().split('\n')
    for line in sigdata:
      if ('[+]' in line):
        global_positive_out.append(line)
        ip = re.findall(r'[0-9]+(?:\.[0-9]+){3}', line)[0]
        targets.append(ip)

  if ("Auxiliary module execution completed" in console_data["data"]):
    print (targets)

client = MsfRpcClient('msf',server='172.19.185.119',ssl=True)
console = MsfRpcConsole(client,cb=read_console)

console.execute('use auxiliary/scanner/ssh/ssh_version')
console.execute('set RHOSTS 192.168.1.0/24')
console.execute('set THREADS 64')
console.execute('run')

